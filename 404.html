<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./vite.svg" />
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta name="theme-color" content="#4f46e5" />
    <link rel="apple-touch-icon" href="/icons/icon-512x512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í•´ë³´ì! í–‰ìš´ë¶€ë¥´ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Square+Neo:wght@400;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Metrics API base is set by index.tsx via import.meta.env.VITE_METRICS_API_BASE -->
    <style>
      body {
        font-family: 'Nanum Square Neo', sans-serif;
        background-color: #f8fafc; /* Fallback */
        background-image: linear-gradient(to top, #fff1eb 0%, #e0f2fe 100%);
      }
      @keyframes marquee {
        from { transform: translateX(0); }
        to { transform: translateX(-50%); }
      }
      .animate-marquee {
        animation: marquee 40s linear infinite;
      }
    </style>

  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.1.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/",
    "react/": "https://aistudiocdn.com/react@^19.1.1/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.20.0"
  }
}
</script>
  <script type="module" crossorigin src="/assets/index-DGtyuLYs.js"></script>
  <link rel="stylesheet" crossorigin href="/assets/index-D0g6LghM.css">
</head>
  <body>
    <div id="root"></div>
  <!-- âœ… PWA ì„¤ì¹˜ ë° Safari ì•ˆë‚´ ë°°ë„ˆ -->
<style>
  #pwaInstallBanner {
    display: none;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(30, 30, 30, 0.95);
    color: #fff;
    padding: 14px 18px;
    font-size: 15px;
    z-index: 9999;
    text-align: center;
    box-shadow: 0 -2px 8px rgba(0,0,0,0.3);
    backdrop-filter: blur(4px);
  }
  #pwaInstallBanner button {
    background: #007aff;
    border: none;
    color: white;
    padding: 8px 14px;
    border-radius: 8px;
    margin-left: 8px;
    font-size: 14px;
  }
</style>

<div id="pwaInstallBanner">
  <!-- ë‚´ìš©ì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë™ì ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤ -->
</div>

<script>
(function() {
  const banner = document.getElementById('pwaInstallBanner');
  const ua = navigator.userAgent;
  const isIOS = /iPhone|iPad|iPod/i.test(ua);
  const isAndroid = /Android/i.test(ua);
  const isInAppBrowser = /(KAKAOTALK|NAVER|FBAN|FBAV|Instagram|Line)/i.test(ua);

  // ì´ë¯¸ ì„¤ì¹˜(standalone) ìƒíƒœë©´ ë°°ë„ˆë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŒ
  const isStandalone = window.matchMedia && window.matchMedia('(display-mode: standalone)').matches;
  if (isStandalone) return;

  // âœ… PWA ì„¤ì¹˜ ì´ë²¤íŠ¸ ê°ì§€ (ì•ˆë“œë¡œì´ë“œ ì „ìš©)
  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    // iOSê°€ ì•„ë‹ˆë©´ PWA ì„¤ì¹˜ ë°°ë„ˆ í‘œì‹œ
    if (!isIOS && !isInAppBrowser) {
      banner.innerHTML = `
        ğŸ“± ì•±ì²˜ëŸ¼ ì‚¬ìš©í•˜ì‹œê² ì–´ìš”?
        <button id="installBtn">í™ˆí™”ë©´ì— ì¶”ê°€</button>
      `;
      banner.style.display = 'block';

      document.getElementById('installBtn').addEventListener('click', async () => {
        banner.style.display = 'none';
        deferredPrompt.prompt();
        const choice = await deferredPrompt.userChoice;
        if (choice.outcome === 'accepted') {
          console.log('ì‚¬ìš©ìê°€ PWA ì„¤ì¹˜ë¥¼ ìˆ˜ë½í•¨');
        }
      });
    }
  });

  // ì„¤ì¹˜ ì™„ë£Œë˜ë©´ ë°°ë„ˆ ìˆ¨ê¹€
  window.addEventListener('appinstalled', () => {
    banner.style.display = 'none';
    // ì´ ì„¤ì¹˜ìˆ˜ ì¹´ìš´íŠ¸(ì•ˆë“œë¡œì´ë“œ ë“± appinstalled ì§€ì›)
    try { window.MAKE_LUCKY && window.MAKE_LUCKY.hitInstallOnce(); } catch (e) {}
  });

  // âœ… iOS + ì¸ì•±ë¸Œë¼ìš°ì € (ì¹´ì¹´ì˜¤í†¡ ë“±)ì¼ ë•Œ Safari ì•ˆë‚´ í‘œì‹œ
  if (isIOS && isInAppBrowser) {
    banner.innerHTML = `
      ğŸ“Œ í™ˆí™”ë©´ ì„¤ì¹˜ë¥¼ ìœ„í•´ Safariì—ì„œ ì—´ì–´ì£¼ì„¸ìš”.
      <button id="openSafariBtn">Safarië¡œ ì—´ê¸°</button>
      <span style="display:block; margin-top:6px; font-size:13px; opacity:0.85;">
        ë§Œì•½ Safariê°€ ì—´ë¦¬ì§€ ì•Šìœ¼ë©´, í™”ë©´ í•˜ë‹¨/ì˜¤ë¥¸ìª½ì˜ <strong>ê³µìœ í•˜ê¸°</strong> ë²„íŠ¼(â¬†ï¸)ì„ ëˆ„ë¥´ê³ 
        <strong>â€œSafariì—ì„œ ì—´ê¸°â€</strong> ë˜ëŠ” <strong>â€œë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°â€</strong>ë¥¼ ì„ íƒí•˜ì„¸ìš”.
      </span>
    `;
    banner.style.display = 'block';

    document.getElementById('openSafariBtn').addEventListener('click', async () => {
      const currentUrl = window.location.href;
      // 1) ìƒˆ ì°½ìœ¼ë¡œ ì—´ê¸° ì‹œë„ (ì¼ë¶€ ì¸ì•±ë¸Œë¼ìš°ì €ëŠ” ì´ í›„ 'Safariì—ì„œ ì—´ê¸°' ì˜µì…˜ ë…¸ì¶œ)
      let opened = null;
      try {
        opened = window.open(currentUrl, '_blank', 'noopener,noreferrer');
      } catch (_) { /* ignore */ }

      // 2) ì£¼ì†Œ ë³µì‚¬ ì‹œë„ (ì‚¬ìš©ì ë³´ì¡°)
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(currentUrl);
        }
      } catch (_) { /* ignore */ }

      // 3) ì•ˆë‚´ ë©”ì‹œì§€ (ì‹¤íŒ¨ ëŒ€ë¹„ ê°€ì´ë“œ)
      setTimeout(() => {
        if (!opened || opened.closed) {
          alert(
            'Safarië¡œ ìë™ìœ¼ë¡œ ì—´ë¦¬ì§€ ì•Šì•˜ë‹¤ë©´,\n' +
            'í™”ë©´ í•˜ë‹¨/ì˜¤ë¥¸ìª½ì˜ ê³µìœ í•˜ê¸°(â¬†ï¸) ë²„íŠ¼ì„ ëˆŒëŸ¬\n' +
            'â€œSafariì—ì„œ ì—´ê¸°â€ ë˜ëŠ” â€œë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°â€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.\n\n' +
            'ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆë‹¤ë©´ Safariì—ì„œ ë¶™ì—¬ë„£ì–´ ì ‘ì†í•  ìˆ˜ ìˆì–´ìš”:\n' + currentUrl
          );
        }
      }, 1200);
    });
  }

  // âœ… iOS Safariì—ì„œëŠ” ì„¤ì¹˜ ì•ˆë‚´ (Add to Home Screen)
  if (isIOS && !isInAppBrowser) {
    banner.innerHTML = `
      ğŸ“² í™ˆí™”ë©´ì— ì•±ì²˜ëŸ¼ ì¶”ê°€í•˜ë ¤ë©´,
      í•˜ë‹¨ì˜ <strong>ê³µìœ  ì•„ì´ì½˜(â¬†ï¸)</strong>ì„ ëˆ„ë¥¸ ë’¤
      <strong>â€œí™ˆ í™”ë©´ì— ì¶”ê°€â€</strong>ë¥¼ ì„ íƒí•˜ì„¸ìš”.
    `;
    banner.style.display = 'block';
    setTimeout(() => banner.style.display = 'none', 20000);
  }

})();
</script>

<!-- âœ… Service Worker ë“±ë¡ (PWA installability ë³´ì¥) -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      // ìƒëŒ€ ê²½ë¡œë¡œ ë“±ë¡: /MakeLucky/ ë° ë£¨íŠ¸ ëª¨ë‘ì—ì„œ ì •ìƒ ë™ì‘
      navigator.serviceWorker.register('./sw.js').catch((err) => {
        console.warn('Service Worker registration failed', err);
      });
    });
  }

  // âœ… iOS ë“± appinstalled ì´ë²¤íŠ¸ê°€ ì—†ëŠ” í™˜ê²½: ë…ë¦½ì‹¤í–‰(standalone) ì²« ì‹¤í–‰ ì‹œ ì„¤ì¹˜ìˆ˜ ì¦ê°€
  (function() {
    try {
      const isStandalone = window.matchMedia && window.matchMedia('(display-mode: standalone)').matches;
      if (isStandalone) {
        try { window.MAKE_LUCKY && window.MAKE_LUCKY.hitInstallOnce(); } catch (e) {}
      }
    } catch (e) { /* ignore */ }
  })();
  </script>

  </body>
</html>